(()=>{var u=new Image;u.src="https://phucdaivo-magic.github.io/todo-word/www/assets/aaa.jpg";var d=class{constructor(t=document.getElementById("game")){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.characters=[],this.loop()}registerCharacter(t){this.characters.push(t)}start(){this.loop()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.characters.forEach(t=>{t.draw(this)}),requestAnimationFrame(this.loop.bind(this))}loop(){this.update&&this.update(),this.draw()}},o=class{constructor(){this.x=1,this.y=0,this.width=100,this.height=100,this.color="red"}},n=class extends o{constructor(){super(),this.color="blue",this.height=20,this.y=document.querySelector("#game").height-this.height,this.cans=[]}updateAll({x:t,y:i}){this.x=Math.max(0,Math.min(t,document.querySelector("#game").width-this.width))}draw(t){this.update&&this.update(),t.ctx.fillStyle=this.color,t.ctx.fillRect(this.x,this.y,this.width,this.height),this.cans.forEach(i=>{i?.draw(t,this)})}pushCan(t){this.cans.push(t)}isHit(t){if(this.cans.length===0){let i=t.x>=this.x&&t.x<=this.x+this.width,e=t.y+t.height>=this.y;return{isHit:i&&e}}else{let i=this.cans.at(-1),e=t.x>=i.xHitStart&&t.x+t.width<=i.xHitEnd,c=t.y+t.height>=i.y&&t.y+t.height<=i.y+i.height+10;if(t.y+t.height>=i.y+20){let a=8;return t.x<i.xHitStart?a=-8:t.x+t.width>i.xHitEnd&&(a=8),{isHit:!1,rotate:a}}return{isHit:e&&c}}}},l=class extends o{constructor(){super(),this.color="green",this.height=506/2,this.width=195/2,this.speed=4,this.angle=0}draw(t){this.update&&this.update(),this.y+=this.speed,t.ctx.fillStyle=this.color,!this.angle&&t.ctx.fillRect(this.x,this.y,this.width,this.height),t.ctx.save(),t.ctx.translate(this.x+this.width/2+this.angle/4,this.y+this.height/2),t.ctx.rotate(this.angle*Math.PI/180),t.ctx.drawImage(u,-this.width/2,-this.height/2,this.width,this.height),t.ctx.restore()}rotate(t){this.angle+=t}},x=class extends o{constructor(t,i){super(),this.player=i,this.color="yellow",this.height=t.height,this.width=t.width,this.x=t.x,this.y=t.y,this.distance=t.x-i.x,this.xHitStart=this.player.x+this.distance-10,this.xHitEnd=this.player.x+this.distance+this.width+10}draw(t){this.update&&this.update();let i=this.width,e=this.height,c=this.player.x+this.distance,a=this.y,y=c+i/2,g=a+e/2;t.ctx.fillStyle=this.color,t.ctx.save(),t.ctx.translate(y,g),t.ctx.rotate(this.distance/3*Math.PI/180),t.ctx.drawImage(u,-i/2,-e/2,i,e),t.ctx.restore(),this.xHitStart=this.player.x+this.distance-10,this.xHitEnd=this.player.x+this.distance+this.width+10,t.ctx.fillStyle="#fff"}};document.addEventListener("mousemove",h=>{r.updateAll({x:h.clientX})});var s=new l,r=new n;s.update=()=>{let{isHit:h,rotate:t}=r.isHit(s);h?(r.pushCan(new x(s,r)),s.y=-s.height,s.x=Math.random()*(document.querySelector("#game").width-s.width),s.angle=0,console.log("Pushed can")):t&&s.rotate(t),s.y>r.y+r.height&&(s.y=-s.height,s.angle=0,s.x=Math.random()*(document.querySelector("#game").width-s.width))};var w=new d;w.registerCharacter(r);w.registerCharacter(s);new EventSource("/esbuild").addEventListener("change",()=>location.reload());})();
