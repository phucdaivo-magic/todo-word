(()=>{var S="../assets/aaa.jpg";var x=new Image;x.src=S;var d=class{constructor(t=document.getElementById("game")){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.characters=[],this.loop()}registerCharacter(t){this.characters.push(t)}start(){this.loop()}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.characters.forEach(t=>{t.draw(this)}),requestAnimationFrame(this.loop.bind(this))}loop(){this.update&&this.update(),this.draw()}},c=class{constructor(){this.x=1,this.y=0,this.width=100,this.height=100,this.color="red"}},w=class extends c{constructor(){super(),this.color="blue",this.height=20,this.y=document.querySelector("#game").height-this.height,this.cans=[]}updateAll({x:t,y:i}){this.x=Math.max(0,Math.min(t,document.querySelector("#game").width-this.width))}draw(t){this.update&&this.update(),t.ctx.fillStyle=this.color,t.ctx.fillRect(this.x,this.y,this.width,this.height),this.cans.forEach(i=>{i?.draw(t,this)})}pushCan(t){this.cans.push(t)}isHit(t){if(this.cans.length===0){let i=t.x>=this.x&&t.x<=this.x+this.width,h=t.y+t.height>=this.y;return{isHit:i&&h}}else{let i=this.cans.at(-1),h=t.x>=i.xHitStart&&t.x+t.width<=i.xHitEnd,o=t.y+t.height>=i.y&&t.y+t.height<=i.y+i.height+10;if(t.y+t.height>=i.y+20){let n=8;return t.x<i.xHitStart?n=-8:t.x+t.width>i.xHitEnd&&(n=8),{isHit:!1,rotate:n}}return{isHit:h&&o}}}},l=class extends c{constructor(){super(),this.color="green",this.height=506/2,this.width=195/2,this.speed=4,this.angle=0}draw(t){this.update&&this.update(),this.y+=this.speed,t.ctx.fillStyle=this.color,!this.angle&&t.ctx.fillRect(this.x,this.y,this.width,this.height),t.ctx.save(),t.ctx.translate(this.x+this.width/2+this.angle/4,this.y+this.height/2),t.ctx.rotate(this.angle*Math.PI/180),t.ctx.drawImage(x,-this.width/2,-this.height/2,this.width,this.height),t.ctx.restore()}rotate(t){this.angle+=t}},a=class extends c{constructor(t,i){super(),this.player=i,this.color="yellow",this.height=t.height,this.width=t.width,this.x=t.x,this.y=t.y,this.distance=t.x-i.x,this.xHitStart=this.player.x+this.distance-10,this.xHitEnd=this.player.x+this.distance+this.width+10}draw(t){this.update&&this.update();let i=this.width,h=this.height,o=this.player.x+this.distance,n=this.y,N=o+i/2,p=n+h/2;t.ctx.fillStyle=this.color,t.ctx.save(),t.ctx.translate(N,p),t.ctx.rotate(this.distance/3*Math.PI/180),t.ctx.drawImage(x,-i/2,-h/2,i,h),t.ctx.restore(),this.xHitStart=this.player.x+this.distance-10,this.xHitEnd=this.player.x+this.distance+this.width+10,t.ctx.fillStyle="#fff"}};document.addEventListener("mousemove",e=>{r.updateAll({x:e.clientX})});var s=new l,r=new w;s.update=()=>{let{isHit:e,rotate:t}=r.isHit(s);e?(r.pushCan(new a(s,r)),s.y=-s.height,s.x=Math.random()*(document.querySelector("#game").width-s.width),s.angle=0,console.log("Pushed can")):t&&s.rotate(t),s.y>r.y+r.height&&(s.y=-s.height,s.angle=0,s.x=Math.random()*(document.querySelector("#game").width-s.width))};var J=new d;J.registerCharacter(r);J.registerCharacter(s);new EventSource("/esbuild").addEventListener("change",()=>location.reload());})();
