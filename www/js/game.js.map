{
  "version": 3,
  "sources": ["../../src/js/game.js"],
  "sourcesContent": ["\nconst img = new Image();\nimport aaa from \"../../src/images/aaa.jpg\";\nimg.src = aaa;\nclass GameMagi {\n    constructor(canvas = document.getElementById(\"game\")) {\n        this.canvas = canvas;\n        this.ctx = this.canvas.getContext(\"2d\");\n        this.characters = [];\n        this.loop();\n    }\n\n    registerCharacter(character) {\n        this.characters.push(character);\n    }\n\n    start() {\n        this.loop();\n    }\n\n    draw() {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.characters.forEach(character => {\n            character.draw(this);\n        });\n        requestAnimationFrame(this.loop.bind(this));\n    }\n\n    loop() {\n        if (this.update) {\n            this.update();\n        }\n        this.draw();\n    }\n}\n\nclass Character {\n    constructor() {\n        this.x = 1;\n        this.y = 0;\n        this.width = 100;\n        this.height = 100;\n        this.color = \"red\";\n    }\n}\n\nclass Player extends Character {\n    constructor() {\n        super();\n        this.color = \"blue\";\n        this.height = 20\n        this.y = document.querySelector(\"#game\").height - this.height;\n        this.cans = [];\n    }\n\n    updateAll({ x, y }) {\n        this.x = Math.max(0, Math.min(x, document.querySelector(\"#game\").width - this.width));\n    }\n\n    draw(game) {\n        if (this.update) {\n            this.update();\n        }\n        game.ctx.fillStyle = this.color;\n        game.ctx.fillRect(this.x, this.y, this.width, this.height);\n        this.cans.forEach(can => {\n            can?.draw(game, this);\n        });\n    }\n\n    pushCan(can) {\n        this.cans.push(can);\n    }\n\n    isHit(can) {\n\n        if (this.cans.length === 0) {\n            const isX = can.x >= this.x && can.x <= this.x + this.width;\n            const isY = can.y + can.height >= this.y;\n            return {\n                isHit: isX && isY,\n            }\n        } else {\n            const lastCan = this.cans.at(-1);\n            const isX = can.x >= lastCan.xHitStart && can.x + can.width <= lastCan.xHitEnd;\n            const isY = can.y + can.height >= lastCan.y && can.y + can.height <= lastCan.y + lastCan.height + 10;\n\n            if (can.y + can.height >= lastCan.y + 20 ){\n                let rotate = 8;\n\n                if (can.x < lastCan.xHitStart ){\n                    rotate = -8;\n                } else if (can.x + can.width > lastCan.xHitEnd ){\n                    rotate = 8;\n                }\n\n                return {\n                    isHit: false,\n                    rotate: rotate,\n                }\n            }   \n            return {\n                isHit: isX && isY,\n            }\n        }\n    }\n}\n\nclass Can extends Character {\n    constructor() {\n        super();\n        this.color = \"green\";\n        this.height = 506 / 2;\n        this.width = 195 /2 ;\n        this.speed = 4;\n        this.angle = 0;\n    }\n\n    draw(game) {\n        if (this.update) {\n            this.update();\n        }\n        this.y += this.speed;\n        game.ctx.fillStyle = this.color;\n        !this.angle && game.ctx.fillRect(this.x, this.y, this.width, this.height);\n        game.ctx.save();\n        game.ctx.translate(this.x + this.width / 2 + this.angle / 4, this.y + this.height / 2);\n        game.ctx.rotate(this.angle * Math.PI / 180);\n        game.ctx.drawImage(img, -this.width / 2, -this.height / 2, this.width, this.height);\n        game.ctx.restore();\n\n      \n    }\n\n    rotate(rotate) {\n        this.angle += rotate;\n    }\n}\n\nclass CanOfPlayer extends Character {\n    constructor(can, player) {\n        super();\n        this.player = player;\n        this.color = \"yellow\";\n        this.height = can.height;\n        this.width = can.width;\n        this.x = can.x;\n        this.y = can.y\n        this.distance = can.x - player.x;\n\n        this.xHitStart = this.player.x + this.distance - 10;\n        this.xHitEnd = this.player.x + this.distance + this.width + 10;\n    }\n\n    draw(game) {\n        if (this.update) {\n            this.update();\n        }\n        const w = this.width\n        const h = this.height\n        const x = this.player.x + this.distance\n        const y = this.y\n        const xCenter = x + w / 2\n        const yCenter = y + h / 2\n\n        game.ctx.fillStyle = this.color;\n        game.ctx.save()\n        game.ctx.translate(xCenter, yCenter);\n        game.ctx.rotate(this.distance/ 3 * Math.PI / 180);\n        game.ctx.drawImage(img, -w / 2, -h / 2, w, h);\n        game.ctx.restore();\n\n        this.xHitStart = this.player.x + this.distance - 10;\n        this.xHitEnd = this.player.x + this.distance + this.width + 10;\n\n\n        game.ctx.fillStyle = '#fff'\n        // game.ctx.fillRect(this.xHitStart, this.y, this.xHitEnd - this.xHitStart, 10);\n    }\n}\n\n\n\ndocument.addEventListener(\"mousemove\", (e) => {\n    player.updateAll({ x: e.clientX });\n});\n\n\nconst can = new Can();\nconst player = new Player();\n\ncan.update = () => {\n    const { isHit, rotate } = player.isHit(can);\n    if (isHit) {\n        player.pushCan(new CanOfPlayer(can, player));\n        can.y = -can.height;\n        can.x = Math.random() * (document.querySelector(\"#game\").width - can.width);\n        can.angle = 0;\n        console.log(\"Pushed can\");\n    } else if (rotate) {\n        can.rotate(rotate);\n    }\n    if (can.y > player.y + player.height) {\n        can.y = -can.height;\n        can.angle = 0;\n        can.x = Math.random() * (document.querySelector(\"#game\").width - can.width);\n    }\n}\n\n\n\nconst game = new GameMagi();\n\ngame.registerCharacter(player);\ngame.registerCharacter(can);\n\nnew EventSource(\"/esbuild\").addEventListener(\"change\", () => location.reload());\n"],
  "mappings": "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",
  "names": ["img", "aaa_default", "GameMagi", "canvas", "character", "Character", "Player", "x", "y", "game", "can", "isX", "isY", "lastCan", "rotate", "Can", "CanOfPlayer", "player", "w", "xCenter", "yCenter", "isHit"]
}
