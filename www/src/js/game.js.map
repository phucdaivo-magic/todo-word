{
  "version": 3,
  "sources": ["../../../src/js/game.js"],
  "sourcesContent": ["\r\nconst img = new Image();\r\nimg.src = 'https://phucdaivo-magic.github.io/todo-word/www/assets/aaa.jpg';\r\nclass GameMagi {\r\n    constructor(canvas = document.getElementById(\"game\")) {\r\n        this.canvas = canvas;\r\n        this.ctx = this.canvas.getContext(\"2d\");\r\n        this.characters = [];\r\n        this.loop();\r\n    }\r\n\r\n    registerCharacter(character) {\r\n        this.characters.push(character);\r\n    }\r\n\r\n    start() {\r\n        this.loop();\r\n    }\r\n\r\n    draw() {\r\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n        this.characters.forEach(character => {\r\n            character.draw(this);\r\n        });\r\n        requestAnimationFrame(this.loop.bind(this));\r\n    }\r\n\r\n    loop() {\r\n        if (this.update) {\r\n            this.update();\r\n        }\r\n        this.draw();\r\n    }\r\n}\r\n\r\nclass Character {\r\n    constructor() {\r\n        this.x = 1;\r\n        this.y = 0;\r\n        this.width = 100;\r\n        this.height = 100;\r\n        this.color = \"red\";\r\n    }\r\n}\r\n\r\nclass Player extends Character {\r\n    constructor() {\r\n        super();\r\n        this.color = \"blue\";\r\n        this.height = 20\r\n        this.y = document.querySelector(\"#game\").height - this.height;\r\n        this.cans = [];\r\n    }\r\n\r\n    updateAll({ x, y }) {\r\n        this.x = Math.max(0, Math.min(x, document.querySelector(\"#game\").width - this.width));\r\n    }\r\n\r\n    draw(game) {\r\n        if (this.update) {\r\n            this.update();\r\n        }\r\n        game.ctx.fillStyle = this.color;\r\n        game.ctx.fillRect(this.x, this.y, this.width, this.height);\r\n        this.cans.forEach(can => {\r\n            can?.draw(game, this);\r\n        });\r\n    }\r\n\r\n    pushCan(can) {\r\n        this.cans.push(can);\r\n    }\r\n\r\n    isHit(can) {\r\n\r\n        if (this.cans.length === 0) {\r\n            const isX = can.x >= this.x && can.x <= this.x + this.width;\r\n            const isY = can.y + can.height >= this.y;\r\n            return {\r\n                isHit: isX && isY,\r\n            }\r\n        } else {\r\n            const lastCan = this.cans.at(-1);\r\n            const isX = can.x >= lastCan.xHitStart && can.x + can.width <= lastCan.xHitEnd;\r\n            const isY = can.y + can.height >= lastCan.y && can.y + can.height <= lastCan.y + lastCan.height + 10;\r\n\r\n            if (can.y + can.height >= lastCan.y + 20) {\r\n                let rotate = 8;\r\n\r\n                if (can.x < lastCan.xHitStart) {\r\n                    rotate = -8;\r\n                } else if (can.x + can.width > lastCan.xHitEnd) {\r\n                    rotate = 8;\r\n                }\r\n\r\n                return {\r\n                    isHit: false,\r\n                    rotate: rotate,\r\n                }\r\n            }\r\n            return {\r\n                isHit: isX && isY,\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nclass Can extends Character {\r\n    constructor() {\r\n        super();\r\n        this.color = \"green\";\r\n        this.height = 506 / 2;\r\n        this.width = 195 / 2;\r\n        this.speed = 4;\r\n        this.angle = 0;\r\n    }\r\n\r\n    draw(game) {\r\n        if (this.update) {\r\n            this.update();\r\n        }\r\n        this.y += this.speed;\r\n        game.ctx.fillStyle = this.color;\r\n        !this.angle && game.ctx.fillRect(this.x, this.y, this.width, this.height);\r\n        game.ctx.save();\r\n        game.ctx.translate(this.x + this.width / 2 + this.angle / 4, this.y + this.height / 2);\r\n        game.ctx.rotate(this.angle * Math.PI / 180);\r\n        game.ctx.drawImage(img, -this.width / 2, -this.height / 2, this.width, this.height);\r\n        game.ctx.restore();\r\n\r\n\r\n    }\r\n\r\n    rotate(rotate) {\r\n        this.angle += rotate;\r\n    }\r\n}\r\n\r\nclass CanOfPlayer extends Character {\r\n    constructor(can, player) {\r\n        super();\r\n        this.player = player;\r\n        this.color = \"yellow\";\r\n        this.height = can.height;\r\n        this.width = can.width;\r\n        this.x = can.x;\r\n        this.y = can.y\r\n        this.distance = can.x - player.x;\r\n\r\n        this.xHitStart = this.player.x + this.distance - 10;\r\n        this.xHitEnd = this.player.x + this.distance + this.width + 10;\r\n    }\r\n\r\n    draw(game) {\r\n        if (this.update) {\r\n            this.update();\r\n        }\r\n        const w = this.width\r\n        const h = this.height\r\n        const x = this.player.x + this.distance\r\n        const y = this.y\r\n        const xCenter = x + w / 2\r\n        const yCenter = y + h / 2\r\n\r\n        game.ctx.fillStyle = this.color;\r\n        game.ctx.save()\r\n        game.ctx.translate(xCenter, yCenter);\r\n        game.ctx.rotate(this.distance / 3 * Math.PI / 180);\r\n        game.ctx.drawImage(img, -w / 2, -h / 2, w, h);\r\n        game.ctx.restore();\r\n\r\n        this.xHitStart = this.player.x + this.distance - 10;\r\n        this.xHitEnd = this.player.x + this.distance + this.width + 10;\r\n\r\n\r\n        game.ctx.fillStyle = '#fff'\r\n        // game.ctx.fillRect(this.xHitStart, this.y, this.xHitEnd - this.xHitStart, 10);\r\n    }\r\n}\r\n\r\n\r\n\r\ndocument.addEventListener(\"mousemove\", (e) => {\r\n    player.updateAll({ x: e.clientX });\r\n});\r\n\r\n\r\nconst can = new Can();\r\nconst player = new Player();\r\n\r\ncan.update = () => {\r\n    const { isHit, rotate } = player.isHit(can);\r\n    if (isHit) {\r\n        player.pushCan(new CanOfPlayer(can, player));\r\n        can.y = -can.height;\r\n        can.x = Math.random() * (document.querySelector(\"#game\").width - can.width);\r\n        can.angle = 0;\r\n        console.log(\"Pushed can\");\r\n    } else if (rotate) {\r\n        can.rotate(rotate);\r\n    }\r\n    if (can.y > player.y + player.height) {\r\n        can.y = -can.height;\r\n        can.angle = 0;\r\n        can.x = Math.random() * (document.querySelector(\"#game\").width - can.width);\r\n    }\r\n}\r\n\r\n\r\n\r\nconst game = new GameMagi();\r\n\r\ngame.registerCharacter(player);\r\ngame.registerCharacter(can);\r\n\r\nnew EventSource(\"/esbuild\").addEventListener(\"change\", () => location.reload());\r\n"],
  "mappings": "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",
  "names": ["img", "GameMagi", "canvas", "character", "Character", "Player", "x", "y", "game", "can", "isX", "isY", "lastCan", "rotate", "Can", "CanOfPlayer", "player", "w", "h", "xCenter", "yCenter", "e", "isHit"]
}
